
خطة شاملة لتعديلات وتحسينات في مشروع NanoDrop Analyzer
1. تصحيح تكرار إدخال Factor في تبويب العينة الواحدة (app.py) - تم: تمت إزالة إدخال Factor المتكرر.

    المشكلة: في تبويب العينة الواحدة، لديك متغير factor_input معرف مرتين في نفس العمود (col1_dilution).

    التأثير: تعارض في القيم المدخلة يؤدي لخلل في الإدخال أو الالتباس للمستخدم.

    الحل: حذف أو دمج إدخال Factor ليكون مرة واحدة فقط.

2. تأكد من وجود عمود ratio_260_230 بشكل آمن في process_dataframe (dataframe_processor.py) - تم: تم التحقق من وجود العمود بشكل آمن بالفعل.

    المشكلة: تعتمد دالة المعالجة على مفتاح ratio_260_230 من detected_map بدون تحقق كافٍ مما قد يؤدي لخطأ إذا لم يكن موجودًا أو قيمته None.

    التأثير: احتمالية Exception أو فقدان القيم الصحيحة أثناء المعالجة.

    الحل: إضافة تحقق شرط قبل قراءة العمود:

    if detected_map.get("ratio_260_230") in row.index:
        raw_ratio_260_230 = row[detected_map["ratio_260_230"]]
    else:
        raw_ratio_260_230 = np.nan

3. توحيد أسماء أعمدة التخفيف (volume) في جميع الملفات - تم: تم توحيد الأسماء لتكون "Volume Sample (µl)" و "Volume Diluent (µl)".

    المشكلة: في بعض الملفات تستخدم "Volume Sample (µl)" و "Volume Diluent (µl)" وفي أخرى تستخدم "µl_DNA", "µl_H2O".

    التأثير: عدم الاتساق قد يسبب لبساً في عرض النتائج أو التحليل.

    الحل: اختيار تسمية واحدة (يفضل استخدام النسخة العربية أو الأكثر وضوحاً) وتعديل كل الأكواد لتتوافق معها.

4. توحيد دوال التحويل الآمنة إلى أرقام (float) - تم: تم دمج safe_ratio في safe_float وإزالة safe_ratio.

    المشكلة: تستخدم دالة safe_float في معظم الملفات، لكن في بعض الأماكن تستخدم safe_ratio والتي هي نسخة مشابهة جداً.

    التأثير: تعقيد وصعوبة صيانة الكود مع وجود دوال متشابهة تقوم بنفس الوظيفة.

    الحل: دمج الدالتين في دالة واحدة موحدة safe_float أو إعادة تسمية safe_ratio لتكون واضحة وظيفيًا، ثم توحيد الاستخدام.

5. تحسين ظهور التحذيرات والأخطاء بناءً على قيم التخفيف (app.py) - لم يتم: هذه المهمة لم يتم تنفيذها بعد.

    المشكلة: شرط إظهار رسالة الخطأ عند كون حجم العينة أكبر من الحجم النهائي غير محمي بشكل كامل من قيم NaN.

    التأثير: احتمال ظهور رسائل غير صحيحة أو خطأ في حالة القيم الفارغة.

    الحل: إضافة تحقق صريح قبل المقارنة، وهو موجود جزئياً لكن يمكن تحسينه للوضوح.

6. إضافة زر لإعادة تعيين المدخلات في تبويب العينة الواحدة - تم: تمت إضافة زر "إعادة تعيين" يقوم بإعادة القيم إلى الافتراضي.

    الفكرة: وجود زر “إعادة تعيين” يعيد القيم الافتراضية (مثل factor=50، target_conc، final_vol، إلخ) ويسهل على المستخدم إعادة الإدخال من جديد دون الحاجة لإعادة تحميل الصفحة.

    التأثير: تحسين تجربة المستخدم وتسهيل التجربة التكرارية.

7. تحسين دعم تحميل ملف CSV/Excel في تبويب الدفعات - تم: تمت إضافة تنبيهات للأعمدة المفقودة (A260 و Sample Type).

    المشاكل المحتملة:

        التعامل مع الأعمدة غير القياسية أو ذات أسماء غير متوقعة.

        إعطاء تحذيرات واضحة عند نقص الأعمدة الأساسية (مثل A260 أو Sample Type).

    الحل: تحسين دالة map_columns أو إضافة تحذيرات واضحة قبل التحليل.

8. تحسين التعليقات والتوثيق داخل الأكواد - لم يتم: هذه المهمة لم يتم تنفيذها بعد.

    إضافة تعليقات واضحة وموجزة خاصة في الأماكن التي تحتوي على معادلات رياضية أو خطوات منطقية معقدة.

    كتابة docstrings كاملة لكل دالة مع شرح المعطيات والنتائج.

9. تنظيف واستقرار الكود: معالجة القيم المفقودة (NaN) بشكل موحد - تم: تم تحسين معالجة القيم المفقودة في دالة calculate_ratios.

    مثال: في calculate_ratios أو calculate_dilution لا تستخدم دائماً نفس المنطق في التعامل مع القيم الفارغة أو الصفريات.

    اقتراح: توحيد قواعد التعامل مع هذه الحالات في كل الدوال.

10. فصل الأكواد الخاصة بالواجهة (Streamlit) عن الأكواد الحسابية تماما - لم يتم: هذه المهمة لم يتم تنفيذها بعد.

    الوضع الحالي جيد إلى حد ما، لكن يمكن تحسين فصل الطبقات بحيث تكون ملفات الـ backend (utils, processors) مستقلة تماما عن الـ frontend (app.py).

    هذا يسهل الاختبار الوحدوي (unit testing) والصيانة المستقبلية.

11. إضافة اختبارات وحدة (Unit Tests) للأجزاء الأساسية - لم يتم: هذه المهمة لم يتم تنفيذها بعد.

    خاصة لـ:

        دوال utils.py

        process_dataframe في dataframe_processor.py

        process_single_sample في single_sample.py

    الهدف: ضمان صحة الحسابات وعدم كسر الوظائف مع التحديثات.

12. تحسين تجربة المستخدم العربي - لم يتم: هذه المهمة لم يتم تنفيذها بعد.

    إضافة رسائل أكثر تفصيلاً في حالة الإدخال غير الصحيح أو المفقود.

    توحيد المصطلحات بين الرسائل.

    دعم إدخال أرقام بنقط عشرية مختلفة (، أو .) مع التنسيق العربي.

13. تحديث ملف config.json ليشمل وصفًا لكل بروتوكول - لم يتم: هذه المهمة لم يتم تنفيذها بعد.

    إضافة مفتاح وصف (description) لكل بروتوكول لعرضه في الواجهة كمعلومة إضافية للمستخدم.

14. التأكد من دعم ملفات Excel بمختلف الامتدادات (.xls و .xlsx) - لم يتم: هذه المهمة لم يتم تنفيذها بعد.

    استدعاء قراءة ملفات Excel يجب أن يكون بمرونة أكثر.

15. التأكد من توافق الكود مع إصدارات Python و Streamlit الحديثة - لم يتم: هذه المهمة لم يتم تنفيذها بعد.

    التأكد من أن الكود لا يستخدم واجهات قديمة أو غير مدعومة.

ملخص النقاط الأهم التي يجب أن تبدأ بها:

    تصحيح تكرار إدخال Factor في تبويب العينة الواحدة.

    ضمان سلامة قراءة عمود ratio_260_230 في المعالجة الدفعة.

    توحيد أسماء أعمدة التخفيف.

    توحيد دوال تحويل النص إلى أرقام.

    تحسين معالجة القيم المفقودة في كل الدوال الحسابية.

    إضافة زر إعادة تعيين في واجهة العينة الواحدة.

    تحسين دعم تحميل CSV مع تنبيهات الأعمدة المفقودة.

